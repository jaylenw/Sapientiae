language: node_js
node_js:
- 4.2.6
before_script:
- sudo -v && wget -nv -O- https://download.calibre-ebook.com/linux-installer.py |
  sudo python -c "import sys; main=lambda:sys.stderr.write('Download failed\n'); exec(sys.stdin.read());
  main()"
- npm install gitbook-cli -g
- npm install svgexport -g
- gitbook install
- npm install
script:
- npm run lint-md
- gitbook build
- gitbook pdf ./ ./sapientiae.pdf
- gitbook epub ./ ./sapientiae.epub
- gitbook mobi ./ ./sapientiae.mobi
deploy:
  provider: releases
  api_key:
    secure: $SECURE-TOKEN
  file: sapientiae.pdf
  skip_cleanup: true
  on:
    tags: true
  provider: pages
  local_dir: _book
  github_token: $GITHUB_TOKEN
  skip_cleanup: true
  on:
    branch: master
